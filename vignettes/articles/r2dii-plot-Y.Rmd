---
title: "r2dii.plot Y"
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

The goal of r2dii.plot is to help you plot 2DII data in an informative,
beautiful, and easy way.

## Installation

You can install the development version of r2dii.plot from
[GitHub](https://github.com/2DegreesInvesting/r2dii.plot) with:

```r
# install.packages("devtools")
devtools::install_github("2DegreesInvesting/r2dii.plot")
```

## Example

The r2dii.plot package is designed to work smoothly with other "r2dii" packages
-- [r2dii.data](https://2degreesinvesting.github.io/r2dii.data/),
[r2dii.match](https://2degreesinvesting.github.io/r2dii.match/), and
[r2dii.analysis](https://2degreesinvesting.github.io/r2dii.analysis/). It also
plays well with the popular packages [dplyr](https://www.tidyverse.org/) and
[ggplot2](https://ggplot2.tidyverse.org/), which help you customize your plots.

```{r setup}
library(dplyr, warn.conflicts = FALSE)
library(ggplot2, warn.conflicts = FALSE)
library(r2dii.plot)
```

Your data typically comes from the output of two functions in the r2dii.analysis
package:
[`target_sda()`](https://2degreesinvesting.github.io/r2dii.analysis/reference/target_sda.html)
and
[`target_market_share()`](https://2degreesinvesting.github.io/r2dii.analysis/reference/target_market_share.html).
Here you'll use two example datasets that come with r2dii.plot.

```{r}
sda

market_share
```

Before plotting, you need to prepare your data. The following sections show the
preparation and plotting workflow for the three kinds of plots that r2dii.plot
supports: timeline, techmix, and trajectory.

### Timeline

The timeline plot uses `sda`-like data. First prepare it with
`prep_timelineY()`, then plot it with `plot_timelineY()`.

Use `prep_timelineY()` to prepare the data. You'll need to subset the data to
meet the requirements of the `plot_timelineY()`, which you can do with the
argument `sector_filter`. If you forget, the error message should guide you.

```{r error = TRUE}
# Fails
prep_timelineY(sda)

# Works
cement <- prep_timelineY(sda, sector_filter = "cement")
# Same
cement <- prep_timelineY(filter(sda, sector == "cement"))

cement
```

* `plot_timelineY()` defaults to recoding `line_name` to title case, and allows
custom recoding and color setting via a data frame passed to the argument 
`specs`.

```{r}
# Default recoding
plot_timelineY(cement)

# Custom recoding
custom <- tribble(
                ~line_name,                  ~label,        ~hex,
               "projected",                 "Proj.",   "#4a5e54",
       "corporate_economy",         "Corp. Economy",   "#a63d57",
             "target_demo",         "Target (demo)",   "#78c4d6",
  "adjusted_scenario_demo",  "Adj. Scenario (demo)",   "#f2e06e",
)

plot_timelineY(cement, specs = custom)
```

### Techmix

The techmix plot uses `market_share`-like data. First prepare it with
`prep_techmixY()`, then plot it with `plot_techmixY()`. `prep_techmiY()` 
includes a number of arguments that help you meet the `data` requirements
of `plot_techmixY()`.

```{r}
data <- prep_techmixY(
  market_share,
  sector_filter = "power",
  years_filter = c(2020, 2025),
  region_filter = "global",
  scenario_source_filter = "demo_2020",
  scenario_filter = "sds",
  value = "technology_share"
)

plot_techmixY(data)
```

### Trajectory

The techmix plot uses `market_share`-like data. First prepare it with
`prep_trajectoryY()`, then plot it with `plot_trajectoryY()`. As you may expect
by now, `prep_trajectoryY()` includes arguments to meet the `data` requirements 
of `plot_trajectoryY()`. `plot_trajectoryY()` inputs a number of data frames 
which you can create with `dplyr::tibble()`.

```{r}
data <- prep_trajectoryY(
  market_share,
  sector_filter = "power",
  technology_filter = "renewablescap",
  region_filter = "global",
  scenario_source_filter = "demo_2020",
  value = "production"
)

scenario_specs <- tibble(
  scenario = c("sds", "sps", "cps"),
  label = c("SDS", "STEPS", "CPS")
)

main_line_metric <- tibble(metric = "projected", label = "Portfolio")

additional_line_metrics <- tibble(
  metric = "corporate_economy",
  label = "Corporate Economy"
)

plot_trajectoryY(
  data,
  scenario_specs_good_to_bad = scenario_specs,
  main_line_metric = main_line_metric,
  additional_line_metrics = additional_line_metrics
)
```
